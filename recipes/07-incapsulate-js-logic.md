# Как изолировать js-логику

Часто бывает нужно, что определенная функциональность должна действовать исключительно в рамках какого-то блока.
Например это может быть конкретная страница, или какой-то блок на этой странице.

Кроме того, часто необходимо, чтобы на странице могло быть несколько одинаковых блоков — например это могут быть малые карточки товаров в разделе —
и одна и та же js-логика должна работать независимо для каждого из них.

Продолжим пример с карточками товаров. При клике на кнопку "Купить" следует отправить ajax-запрос на добавление товара в корзину, а саму кнопку деактивировать, заменив текст на "В корзине".

## Разметка

Приведу максимально упрощенный пример:

    <div class="product-card js-product-card" data-product-id="12345">
        <img src="product-image.png">
        <div class="product-card__name">Аннигиляторная пушка</div>
        <div class="product-card__price">100 руб.</div>
        <button class="product-card__buy js-product-card-buy">Купить</button>
    </div>

Обратите внимание на классы с префиксом `js-` — с ними не должны быть связаны стили, они предназначены для биндинга событий.
Аналогично классы вида `product-card__buy` предназначены только для стилей, и на них не следует вешать js-обработчики.

Атрибут `data-product-id`, как можно догадаться, хранит идентификатор товара.

## js-поведение

Мы будем работать с карточкой товара как с единым компонентом, и напишем для этого отдельный класс.
Хорошей практикой будет держать каждый класс в отдельном файле и импортировать их в точке входа js.

    // ./src/scripts/main/components/product-card.js
    class ProductCard {
        constructor(el) {
            this.element = el;
            this.productId = this.element.getAttribute("data-product-id");
            this.buyBtn = this.element.querySelector(".js-product-card-buy");
            this.initEvents();
        }

        initEvents() {
            this.buyBtn.addEventListener("click", e => this.addToBasket(e));
        }

        addToBasket(e) {
            e.preventDefault();
            if (this.buyBtn.disabled) return;

            $.post("/api/basket/add", {product_id: this.productId});
            this.buyBtn.disabled = true;
            this.buyBtn.innerText = "В корзине";
        }
    }

На вход компоненту подается необходимый DOM-элемент, к которому и будет применена логика.
В конструкторе происходит инициализация ряда необходимых параметров и вызывается метод `initEvents()`, чтобы повесить обработчики событий.

Пока что это единственный обработчик нажатия на кнопку. Срабатывать будет еще один метод класса — `addToBasket()`.
В нем мы проверяем, что кнопка активна, делаем ajax-запрос и деактивируем кнопку с заменой текста.

Дальше нам остается только связать этот js-компонент с реальными карточками. Это можно сделать прямо в этом файле:

    document.querySelectorAll(".js-product-card").forEach(card => new ProductCard(card));